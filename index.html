<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Melodic Feed Piano</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Billabong&display=swap');
body, .feed { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif; margin:0; background:#121212; color:#e0e0e0; overflow-x:hidden; }
.header { background:#1f1f1f; padding:10px; box-shadow:0 1px 3px rgba(0,0,0,0.7); position:sticky; top:0; z-index:100; display:flex; align-items:center; gap:5px; flex-wrap:wrap; }
.header h1 { font-family:'Billabong',cursive; font-size:32px; color:#e0e0e0; margin:0; flex:1; }
.menu-btn { background:none;border:none;color:#e0e0e0;font-size:22px;cursor:pointer; }
.dropdown { display:none; position:absolute; top:40px; left:0; background:#1f1f1f; padding:10px; border-radius:8px; z-index:200; max-width:180px; }
.dropdown label, .dropdown select, .dropdown input { color:#e0e0e0; margin-right:5px; font-size:14px; }
.feed { max-width:600px; margin:20px auto; padding:0; }
.post { background:#1e1e1e; border-radius:8px; padding:15px; margin-bottom:15px; box-shadow:0 0 1px rgba(0,0,0,0.5); border:1px solid #333; }
.post-header { display:flex; align-items:center; margin-bottom:10px; }
.avatar { width:40px; height:40px; border-radius:50%; background:#3a3a3a; color:#fff; display:flex; align-items:center; justify-content:center; margin-right:10px; }
.post-actions { display:flex; gap:10px; margin-top:10px; padding-top:10px; border-top:1px solid #444; }
.action-btn { flex:1; padding:8px; border:none; background:none; cursor:pointer; color:#b3b3b3; font-weight:bold; text-align:center; font-size:14px; }
.action-btn:hover { background:#333; border-radius:4px; }
.action-btn.liked { color:#ed4956; }
.skeleton-post { background:#1e1e1e; border-radius:8px; padding:15px; margin-bottom:15px; height:150px; animation:pulse 1.5s infinite; border:1px solid #333; }
@keyframes pulse {0%{opacity:0.6}50%{opacity:1}100%{opacity:0.6}}
#touch-visual { position:fixed; width:30px; height:30px; background:#ff5f6d; border-radius:50%; top:0; left:0; pointer-events:none; opacity:0.5; transform:translate(-50%,-50%); display:none; z-index:300; }
#note-display { position:fixed; top:10px; right:10px; color:#ff5f6d; font-size:18px; font-weight:bold; z-index:400; }
img, video { user-select:none; -webkit-user-drag:none; touch-action:none; }
</style>
</head>
<body>

<div class="header">
  <h1>üéµ MeloFeed</h1>
  <div style="position:relative;"><button class="menu-btn" id="menu-instr">üéπ</button>
    <div class="dropdown" id="instr-dropdown">
      <label>Instrument:</label>
      <select id="instrument-select">
        <option value="Piano">Piano</option>
        <option value="Guitar">Guitar</option>
        <option value="Flute">Flute</option>
      </select>
    </div>
  </div>
  <div style="position:relative;"><button class="menu-btn" id="menu-effects">üéõÔ∏è</button>
    <div class="dropdown" id="effects-dropdown">
      <label><input type="checkbox" class="effect-toggle" value="Reverb"> Reverb</label><br>
      <label><input type="checkbox" class="effect-toggle" value="Chorus"> Chorus</label><br>
      <label><input type="checkbox" class="effect-toggle" value="Delay"> Delay</label>
    </div>
  </div>
</div>

<div class="feed" role="feed" aria-live="polite">
  <div id="posts-container"></div>
  <div id="sentinel"></div>
</div>

<div id="touch-visual"></div>
<div id="note-display"></div>

<script src="media-list.js"></script>
<script>
// --- Posts ---
let postId=0,isLoading=false;
function generatePost(){
  const names=['Emma','Liam','Olivia','Noah','Ava'];
  const texts=['Having a great day!','Check this view!','Coffee time','Working on something','Weekend vibes'];
  const media=(typeof mediaList!=='undefined' && mediaList.length>0 && Math.random()>0.5)?mediaList[Math.floor(Math.random()*mediaList.length)]:null;
  return {id:postId++,name:names[Math.floor(Math.random()*names.length)],text:texts[Math.floor(Math.random()*texts.length)],time:'2h ago',media};
}
function createPost(data){
  const post=document.createElement('div'); post.className='post';
  post.dataset.postId=data.id;
  post.innerHTML=`<div class="post-header"><div class="avatar">${data.name[0]}</div><div><strong>${data.name}</strong><div style="font-size:12px;color:#999;">${data.time}</div></div></div>
  <div>${data.text}</div>${data.media?`<div style="margin-top:10px;">${data.media.endsWith('.mp4')?`<video src="${data.media}" controls style="width:100%;border-radius:8px;"></video>`:`<img src="${data.media}" style="width:100%;border-radius:8px;">`}</div>`:''}
  <div class="post-actions"><button class="action-btn like-btn">üëç Like</button><button class="action-btn">üí¨ Comment</button><button class="action-btn">üì§ Share</button></div>`;
  post.querySelector('.like-btn').addEventListener('click',()=>{post.querySelector('.like-btn').classList.toggle('liked');});
  return post;
}
function loadMore(){
  if(isLoading)return;
  isLoading=true;
  const container=document.getElementById('posts-container');
  const feed=document.querySelector('.feed'); feed.setAttribute('aria-busy','true');
  const skeletons=[];
  for(let i=0;i<5;i++){const s=document.createElement('div'); s.className='skeleton-post'; container.appendChild(s); skeletons.push(s);}
  setTimeout(()=>{
    skeletons.forEach(s=>{
      const post=createPost(generatePost());
      s.replaceWith(post);
    });
    feed.setAttribute('aria-busy','false'); isLoading=false;
  },800);
}
window.addEventListener('DOMContentLoaded',()=>{
  const sentinel=document.getElementById('sentinel');
  const observer=new IntersectionObserver(entries=>{if(entries[0].isIntersecting) loadMore();},{rootMargin:'200px 0px'});
  observer.observe(sentinel); loadMore(); setTimeout(()=>loadMore(),100);
});

// --- Menus ---
const menuMap={'menu-instr':'instr-dropdown','menu-effects':'effects-dropdown'};
for(const btnId in menuMap){
  const btn=document.getElementById(btnId), dd=document.getElementById(menuMap[btnId]);
  btn.addEventListener('click',()=>{for(const otherId in menuMap) if(otherId!==btnId) document.getElementById(menuMap[otherId]).style.display='none'; dd.style.display=(dd.style.display==='none'?'block':'none');});
}
const instrumentSelect=document.getElementById('instrument-select'); let selectedInstrument='Piano';
instrumentSelect.addEventListener('change',e=>selectedInstrument=e.target.value);
const effectCheckboxes=document.querySelectorAll('.effect-toggle'); let enabledEffect=null;
effectCheckboxes.forEach(cb=>cb.addEventListener('change',e=>{
  if(e.target.checked){effectCheckboxes.forEach(other=>{if(other!==e.target) other.checked=false;}); enabledEffect=e.target.value;} 
  else enabledEffect=null;
}));

// --- Audio system ---
const instrumentsNotes={
  'Piano':['C3','D3','E3','F3','G3','A3','B3','C4','D4','E4','F4','G4','A4','B4','C5'],
  'Guitar':['C3','D3','E3','F3','G3','A3','B3','C4','D4','E4','F4','G4','A4','B4','C5'],
  'Flute':['C3','D3','E3','F3','G3','A3','B3','C4','D4','E4','F4','G4','A4','B4','C5']
};
const audioCache={};
let currentAudio=null;
function playNote(note){
  if(currentAudio){currentAudio.pause(); currentAudio.currentTime=0;}
  if(!audioCache[selectedInstrument]) audioCache[selectedInstrument]={};
  if(!audioCache[selectedInstrument][note]){
    const audio=new Audio(`samples/${selectedInstrument.toLowerCase()}/${note}.mp3`);
    audioCache[selectedInstrument][note]=audio;
  }
  currentAudio=audioCache[selectedInstrument][note];
  currentAudio.play();
  document.getElementById('note-display').textContent=note;
}
function yToNote(y){
  const notes=instrumentsNotes[selectedInstrument];
  const index=Math.floor((1-(y/window.innerHeight))*notes.length);
  return notes[Math.max(0,Math.min(notes.length-1,index))];
}
const touchVisual=document.getElementById('touch-visual');
document.addEventListener('pointerdown', e=>{
  if(e.target.closest('.header')) return;
  const note=yToNote(e.clientY);
  playNote(note);
  touchVisual.style.display='block'; touchVisual.style.left=e.clientX+'px'; touchVisual.style.top=e.clientY+'px';
});
document.addEventListener('pointermove', e=>{
  if(e.pressure>0 || e.buttons>0){
    const note=yToNote(e.clientY);
    playNote(note);
    touchVisual.style.left=e.clientX+'px'; touchVisual.style.top=e.clientY+'px';
  }
});
document.addEventListener('pointerup', e=>{
  currentAudio=null;
  touchVisual.style.display='none';
  document.getElementById('note-display').textContent='';
});
</script>
</body>
</html>
