<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Melodic Feed</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Billabong&display=swap');
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        background: #fafafa;
        user-select: none; /* impedir selecci√≥n */
    }
    header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px;
        background: white;
        border-bottom: 1px solid #dbdbdb;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    header h1 {
        font-family: 'Billabong', cursive;
        font-size: 28px;
    }
    .menu-icon {
        font-size: 22px;
        cursor: pointer;
    }
    .dropdown {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 50px;
        right: 10px;
        background: white;
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        z-index: 20;
    }
    .dropdown label {
        font-size: 14px;
        margin-top: 5px;
    }
    .feed {
        max-width: 600px;
        margin: auto;
        padding: 10px;
    }
    .post {
        background: white;
        border: 1px solid #dbdbdb;
        border-radius: 10px;
        margin-bottom: 20px;
        overflow: hidden;
    }
    .post-header {
        display: flex;
        align-items: center;
        padding: 10px;
    }
    .avatar {
        width: 40px;
        height: 40px;
        border-radius: 20px;
        margin-right: 10px;
    }
    .username {
        font-weight: bold;
        font-size: 14px;
    }
    .post-content {
        padding: 10px;
        font-size: 14px;
    }
    .post img, .post video {
        width: 100%;
        height: auto;
        max-height: 70vh; /* l√≠mite para m√≥vil */
        object-fit: contain; /* mantener proporci√≥n */
        display: block;
    }
    .post video {
        background: black;
        cursor: pointer;
    }
    .post-actions {
        display: flex;
        justify-content: space-around;
        padding: 8px;
        border-top: 1px solid #eee;
    }
    .post-actions button {
        border: none;
        background: none;
        cursor: pointer;
        font-size: 14px;
    }
</style>
</head>
<body>
<header>
    <h1>Melodic Feed</h1>
    <div class="menu-icon">‚ò∞</div>
    <div class="dropdown">
        <label>BPM: <input type="number" id="arpeggioBPM" value="120" min="40" max="240"></label>
        <label>Arpeggio Type:
            <select id="arpeggioType">
                <option value="up">Ascendente</option>
                <option value="down">Descendente</option>
                <option value="random">Random</option>
            </select>
        </label>
        <label>Escala:
            <select id="scaleSelect">
                <option value="major">Mayor</option>
                <option value="minor">Menor</option>
                <option value="pentatonic">Pentat√≥nica</option>
            </select>
        </label>
    </div>
</header>
<div class="feed" id="feed"></div>

<script src="https://unpkg.com/tone"></script>
<script>
// --- Datos ficticios ---
const users=["Luna","Orfeo","Sibila","Dafne","Eur√≠dice","Apolo"];
const descriptions=["Perdido en melod√≠as","Una nota tras otra","El eco del alma","Paisajes sonoros","Arpegios del viento","Silencio entre acordes"];
const mediaList=["media/img1.jpg","media/img2.jpg","media/vid1.mp4","media/img3.jpg","media/vid2.mp4","media/img4.jpg"];

function generatePost(){
    if(mediaList.length===0) return null;
    const user=users[Math.floor(Math.random()*users.length)];
    const desc=descriptions[Math.floor(Math.random()*descriptions.length)];
    const media=mediaList.shift();
    return {user:user,text:desc,media:media,time:"Just now"};
}
function renderMedia(m){
    if(m.endsWith(".mp4")) return `<video preload="metadata" muted><source src="${m}" type="video/mp4"></video>`;
    return `<img src="${m}" alt="">`;
}
function createPost(data){
    const feed=document.getElementById("feed");
    const post=document.createElement("div"); post.className="post";
    post.innerHTML=`<div class="post-header"><img src="https://placekitten.com/40/40" class="avatar"><div>
    <div class="username">${data.user}</div><div style="font-size:12px;color:#999;">${data.time}</div></div></div>
    <div class="post-content">${data.text}</div>${data.media?renderMedia(data.media):""}
    <div class="post-actions"><button>üëç Like</button><button>üí¨ Comment</button><button>üì§ Share</button></div>`;
    const video=post.querySelector("video");
    if(video){video.addEventListener("click",()=>{video.muted=false; video.play();});}
    feed.appendChild(post); return post;
}
function loadMore(){for(let i=0;i<5;i++){const d=generatePost(); if(d) createPost(d);}}
window.addEventListener("DOMContentLoaded",()=>{loadMore();
    const sentinel=document.createElement("div"); document.getElementById("feed").appendChild(sentinel);
    const obs=new IntersectionObserver(e=>{if(e[0].isIntersecting) loadMore();},{rootMargin:"200px"});
    obs.observe(sentinel);
});

// --- Synth & escalas ---
const tonalities=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const scales={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],pentatonic:[0,2,4,7,9]};
let currentScale="major",currentTonality="C";
let activeTouches={},arpeggioInterval=null;
const synth=new Tone.Synth().toDestination();

function getNoteFromY(y){
    const scale=scales[currentScale]; const idx=tonalities.indexOf(currentTonality);
    const h=window.innerHeight; const pos=1-(y/h); const total=scale.length*2;
    const index=Math.floor(pos*total); const octave=3+Math.floor(index/scale.length);
    const semitone=(scale[index%scale.length]+idx)%12;
    return tonalities[semitone]+octave;
}

function startTouch(y,x,id){
    Tone.start();
    activeTouches[id]={y:y,x:x,osc:null};
    if(Object.keys(activeTouches).length===2){
        if(arpeggioInterval){clearInterval(arpeggioInterval);arpeggioInterval=null;return;}
        const baseY=Math.min(...Object.values(activeTouches).map(t=>t.y));
        startArpeggio(baseY);return;
    }
    const note=getNoteFromY(y);
    const osc=new Tone.Synth().toDestination(); osc.triggerAttack(note);
    activeTouches[id].osc=osc;
}
function updateTouch(y,x,id){
    if(activeTouches[id] && activeTouches[id].osc){
        const note=getNoteFromY(y);
        activeTouches[id].osc.setNote(note);
    }
}
function endTouch(id){
    if(activeTouches[id]){
        if(activeTouches[id].osc){activeTouches[id].osc.triggerRelease(); activeTouches[id].osc.dispose();}
        delete activeTouches[id];
        if(arpeggioInterval){clearInterval(arpeggioInterval); arpeggioInterval=null;}
    }
}

function startArpeggio(baseY){
    const scale=scales[currentScale]; const tIndex=tonalities.indexOf(currentTonality);
    const h=window.innerHeight; const pos=1-(baseY/h); const total=scale.length*2;
    const baseIndex=Math.floor(pos*total); const baseOct=3+Math.floor(baseIndex/scale.length);
    const baseSemi=(scale[baseIndex%scale.length]+tIndex)%12;
    const notes=[]; let idx=baseIndex;
    for(let i=0;i<8;i++){const oct=3+Math.floor(idx/scale.length);
        const semi=(scale[idx%scale.length]+tIndex)%12;
        notes.push(tonalities[semi]+oct); idx+=2;}
    const bpm=parseInt(document.getElementById("arpeggioBPM").value)||120;
    const intervalMs=60000/bpm; let nIdx=0;
    const type=document.getElementById("arpeggioType").value;
    arpeggioInterval=setInterval(()=>{
        synth.triggerRelease(); synth.triggerAttackRelease(notes[nIdx],"8n");
        if(type==="up") nIdx=(nIdx+1)%notes.length;
        else if(type==="down") nIdx=(nIdx-1+notes.length)%notes.length;
        else nIdx=Math.floor(Math.random()*notes.length);
    },intervalMs);
}

// --- Eventos pointer/touch ---
window.addEventListener("mousedown",e=>startTouch(e.clientY,e.clientX,"mouse"));
window.addEventListener("mousemove",e=>updateTouch(e.clientY,e.clientX,"mouse"));
window.addEventListener("mouseup",e=>endTouch("mouse"));
window.addEventListener("touchstart",e=>{for(const t of e.touches) startTouch(t.clientY,t.clientX,t.identifier);});
window.addEventListener("touchmove",e=>{for(const t of e.touches) updateTouch(t.clientY,t.clientX,t.identifier);});
window.addEventListener("touchend",e=>{for(const t of e.changedTouches) endTouch(t.identifier);});

// --- Menu toggle ---
document.querySelector(".menu-icon").addEventListener("click",()=>{
    const d=document.querySelector(".dropdown");
    d.style.display=(d.style.display==="flex")?"none":"flex";
});
document.getElementById("scaleSelect").addEventListener("change",e=>{currentScale=e.target.value;});
</script>
</body>
</html>
